<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WebRTC P2P Demo (No Server)</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    video { width: 45%; margin: 10px; border-radius: 8px; background: black; }
    textarea { width: 90%; height: 100px; margin: 10px 0; }
    button { padding: 10px 20px; margin: 5px; cursor: pointer; }
  </style>
</head>
<body>
  <h2>WebRTC Video Call (No Server)</h2>

  <div>
    <video id="localVideo" autoplay playsinline muted></video>
    <video id="remoteVideo" autoplay playsinline></video>
  </div>

  <h3>Caller</h3>
  <button onclick="createOffer()">Create Offer</button>
  <textarea id="offerBox" placeholder="Offer will appear here"></textarea>

  <h3>Receiver</h3>
  <textarea id="remoteOffer" placeholder="Paste offer here"></textarea><br>
  <button onclick="createAnswer()">Create Answer</button>
  <textarea id="answerBox" placeholder="Answer will appear here"></textarea>

  <h3>Caller Paste Answer</h3>
  <textarea id="remoteAnswer" placeholder="Paste answer here"></textarea><br>
  <button onclick="addAnswer()">Connect</button>

  <script>
    const localVideo = document.getElementById("localVideo");
    const remoteVideo = document.getElementById("remoteVideo");
    let pc, localStream;

    const config = { iceServers: [{ urls: "stun:stun.l.google.com:19302" }] };

    async function initStream() {
      if (!localStream) {
        localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        localVideo.srcObject = localStream;
      }
    }

    async function createOffer() {
      await initStream();
      pc = new RTCPeerConnection(config);

      // Add local tracks
      localStream.getTracks().forEach(track => pc.addTrack(track, localStream));

      // Show remote video
      pc.ontrack = (e) => { remoteVideo.srcObject = e.streams[0]; };

      // ICE candidate gathering
      pc.onicecandidate = () => {
        document.getElementById("offerBox").value = JSON.stringify(pc.localDescription);
      };

      const offer = await pc.createOffer();
      await pc.setLocalDescription(offer);
    }

    async function createAnswer() {
      await initStream();
      pc = new RTCPeerConnection(config);

      localStream.getTracks().forEach(track => pc.addTrack(track, localStream));
      pc.ontrack = (e) => { remoteVideo.srcObject = e.streams[0]; };

      const remoteOffer = JSON.parse(document.getElementById("remoteOffer").value);
      await pc.setRemoteDescription(new RTCSessionDescription(remoteOffer));

      const answer = await pc.createAnswer();
      await pc.setLocalDescription(answer);

      pc.onicecandidate = () => {
        document.getElementById("answerBox").value = JSON.stringify(pc.localDescription);
      };
    }

    async function addAnswer() {
      const remoteAnswer = JSON.parse(document.getElementById("remoteAnswer").value);
      if (!pc.currentRemoteDescription) {
        await pc.setRemoteDescription(new RTCSessionDescription(remoteAnswer));
      }
    }
  </script>
</body>
</html>
