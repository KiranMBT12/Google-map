<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WebRTC Video Call (PeerJS Cloud)</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    video { width: 45%; margin: 10px; border-radius: 8px; background: black; }
    input, button { padding: 10px; margin: 5px; }
    #remoteId { width: 250px; }
  </style>
</head>
<body>
  <h2>WebRTC Video Call (PeerJS Cloud)</h2>

  <p>Your ID: <span id="myId">Loading...</span></p>
  <input id="remoteId" type="text" placeholder="Enter friend's ID">
  <button onclick="startCall()">Start Call</button>
  <button onclick="hangUp()">Hang Up</button>

  <div>
    <video id="localVideo" autoplay playsinline muted></video>
    <video id="remoteVideo" autoplay playsinline></video>
  </div>

  <!-- PeerJS library -->
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <script>
    const localVideo = document.getElementById("localVideo");
    const remoteVideo = document.getElementById("remoteVideo");
    const myIdSpan = document.getElementById("myId");
    const remoteIdInput = document.getElementById("remoteId");

    let localStream;
    let currentCall;

    // Connect to PeerJS Cloud (works across the internet)
    const peer = new Peer({
      host: "peerjs.com",
      port: 443,
      secure: true,
      key: "peerjs"
    });

    // Show your peer ID
    peer.on("open", id => {
      myIdSpan.textContent = id;
    });

    // Handle incoming calls
    peer.on("call", call => {
      if (confirm("ðŸ“ž Incoming call from " + call.peer + ". Accept?")) {
        navigator.mediaDevices.getUserMedia({ video: true, audio: true })
          .then(stream => {
            localStream = stream;
            localVideo.srcObject = stream;

            call.answer(stream); // Answer with local stream
            currentCall = call;

            call.on("stream", remoteStream => {
              remoteVideo.srcObject = remoteStream;
            });

            call.on("close", () => {
              alert("Call ended");
              remoteVideo.srcObject = null;
            });
          })
          .catch(err => alert("Error accessing camera/microphone: " + err));
      } else {
        call.close();
      }
    });

    // Start a call
    function startCall() {
      const remoteId = remoteIdInput.value.trim();
      if (!remoteId) return alert("Enter friend's ID");

      navigator.mediaDevices.getUserMedia({ video: true, audio: true })
        .then(stream => {
          localStream = stream;
          localVideo.srcObject = stream;

          const call = peer.call(remoteId, stream);
          currentCall = call;

          call.on("stream", remoteStream => {
            remoteVideo.srcObject = remoteStream;
          });

          call.on("close", () => {
            alert("Call ended");
            remoteVideo.srcObject = null;
          });
        })
        .catch(err => alert("Error accessing camera/microphone: " + err));
    }

    // Hang up the current call
    function hangUp() {
      if (currentCall) {
        currentCall.close();
        currentCall = null;
        remoteVideo.srcObject = null;
      }
    }
  </script>
</body>
</html>
